<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    rel="apple-touch-icon-precomposed"
    sizes="57x57"
    href="/images/favicon/apple-touch-icon-57x57.png"
  />
  <link
    rel="apple-touch-icon-precomposed"
    sizes="114x114"
    href="/images/favicon/apple-touch-icon-114x114.png"
  />
  <link
    rel="apple-touch-icon-precomposed"
    sizes="72x72"
    href="/images/favicon/apple-touch-icon-72x72.png"
  />
  <link
    rel="apple-touch-icon-precomposed"
    sizes="144x144"
    href="/images/favicon/apple-touch-icon-144x144.png"
  />
  <link
    rel="apple-touch-icon-precomposed"
    sizes="60x60"
    href="/images/favicon/apple-touch-icon-60x60.png"
  />
  <link
    rel="apple-touch-icon-precomposed"
    sizes="120x120"
    href="/images/favicon/apple-touch-icon-120x120.png"
  />
  <link
    rel="apple-touch-icon-precomposed"
    sizes="76x76"
    href="/images/favicon/apple-touch-icon-76x76.png"
  />
  <link
    rel="apple-touch-icon-precomposed"
    sizes="152x152"
    href="/images/favicon/apple-touch-icon-152x152.png"
  />
  <link rel="icon" type="image/png" href="/images/favicon/favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="/images/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="/images/favicon/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/images/favicon/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="/images/favicon/favicon-128.png" sizes="128x128" />
  <meta name="application-name" content="Self-Amusement Park" />
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="mstile-144x144.png" />
  <meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
  <meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
  <meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
  <meta name="msapplication-square310x310logo" content="mstile-310x310.png" />

  <title>
    Automatic wireless goodness
  </title>
  <meta
    name="description"
    content="I often work in coffeeshops and other places that provide free wireless networks.Since anyone could sniff traffic sent over these networks, I’ve set up my ow..."
  />

  <link rel="stylesheet" href="/css/main.css">
  <link
    rel="canonical"
    href="https://selfamusementpark.com/coding/automatic-wireless-goodness"
  />
  <link rel="alternate" type="application/rss+xml" title="Self-Amusement Park" href="https://selfamusementpark.com/feed.xml">
</head>


  <body>

    <header class="site-header">
  <div class="wrapper">
    <a class="site-title" href="/">Self-Amusement Park</a>
    <img src="/images/2015/03/apple1-cropped-wpbanner.jpg">
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="sidebar">
          
<img src="/images/bryanstearnsthumb.png" class="headshot">
<p>
  I'm <strong>Bryan Stearns</strong>.<br>
  This is where I blog.<br>
  <span class="also small">
    Me elsewhere:
    <a href="https://twitter.com/bryanstearns" target="_blank" rel="noopener noreferrer"><span class="icon icon--twitter"><svg viewbox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg>
</span></a>
    <a href="https://github.com/bryanstearns" target="_blank" rel="noopener noreferrer"><span class="icon icon--github"><svg viewbox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg>
</span></a>
    <a href="https://www.linkedin.com/in/bryanstearns" target="_blank" rel="noopener noreferrer"><span class="icon icon--linkedin"><svg viewbox="0 50 512 512"><path fill="#828282" d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683 C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615 c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915 s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z"></path></svg>
</span></a>
  </span>
</p>

<p class="also large">
   You can email me at
  <i>my full name at gmail dot com</i>. You can also find me on
  <a href="https://twitter.com/bryanstearns" target="_blank" rel="noopener noreferrer">Twitter</a>,
  <a href="https://github.com/bryanstearns" target="_blank" rel="noopener noreferrer">GitHub</a>, and
  <a href="https://www.linkedin.com/in/bryanstearns" target="_blank" rel="noopener noreferrer">LinkedIn</a>, or
  <a href="/feed.xml">subscribe via RSS</a>.
</p>

<p>
  </p>
<div id="search-container">
    <input type="search" id="search-input" placeholder="Search...">
    <ul id="search-results"></ul>
  </div>
  <script src="/js/simple-jekyll-search.js" type="text/javascript"></script>
  <script>
    SimpleJekyllSearch({
      searchInput: document.getElementById("search-input"),
      resultsContainer: document.getElementById("search-results"),
      json: "/search.json",
      limit: 10,
      debounceTime: 400
    })
  </script>


<nav>
  <h4>Topics</h4>
  <ul>
    
    <li>
       
      <a class="page-link" href="/airplane/">Airplane</a>
      
    </li>
    
    <li>
       
      <a class="page-link" href="/christmas/">Christmas</a>
      
    </li>
    
    <li>
       
      <a class="page-link" href="/coding/">Coding</a>
      
    </li>
    
    <li>
       
      <a class="page-link" href="/general/">General</a>
      
    </li>
    
    <li>
       
      <a class="page-link" href="/travel-local/">Travel &amp; Local</a>
      
    </li>
    
  </ul>
</nav>



        </div>
        <div class="content">
          <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Automatic wireless goodness</h1>
    <p class="post-meta">
      <time datetime="2009-03-07T15:29:18-08:00" itemprop="datePublished">Mar 7, 2009</time>
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
<p>I often work in coffeeshops and other places that provide free wireless networks.
Since anyone could sniff traffic sent over these networks, I’ve set up my own
virtual private network at home so that my traffic will be encrypted before it
leaves my laptop, then decrypted on a server at home and sent out from my home
network <!--more-->- this also gives me secure access to a couple of machines at
home that aren’t otherwise accessible from the internet. I use OpenVPN for
this; it’s open-source, it was relatively easy to set up on my Ubuntu server,
and there’s good support for OpenVPN in the Network Manager included on my
laptop (also running Ubuntu).</p>

<p>This worked great for a while, but a few things bugged me:</p>

<ul>
  <li>The VPN connection doesn’t happen automatically - I had to remember to do it,
and would sometimes forget;</li>
  <li>my favorite hangouts’ wireless networks ask me to accept terms of service
every time I use them, and that got annoying;</li>
  <li>and whenever the DHCP lease renews (which is every few minutes in some
places), the DNS server configuration would be reset to point at the shop’s
DNS server instead of the one I run (so I’d lose the ability to refer to my
home machines by name; it’s also possible that the public DNS server is less
secure than mine, so that’s not good).</li>
</ul>

<p>I set out to remedy these problems, and it turned out to not be too difficult;
I learned a bit about Network Manager in the process, too. Network Manager can
automatically run a script when it associates with a wireless network, so I
wrote <a href="http://gist.github.com/75475" target="_blank" rel="noopener noreferrer">this Python script</a>;
it solves the first two problems: it looks to see what network we associated
with, and if it’s not my home network, it creates the VPN connection. First,
though, if it’s one of the networks that requires a terms-of-service acceptance,
it accepts them and submits the form. (The latter mechanism is specific to the
<a href="http://www.personaltelco.net/" target="_blank" rel="noopener noreferrer">Portland Telco Project</a>
networks we have here in Portland, but you can probably figure out how to customize
it to your own networks - if not, leave a comment.)</p>

<p>The third problem, where DHCP renewal clobbers DNS settings, seems to be known
but unfixed: here’s <a href="https://bugs.launchpad.net/ubuntu/+source/dhcp3/+bug/90681" target="_blank" rel="noopener noreferrer">a
bug about it</a>. The person who reported the bug posted a workaround for this
problem. I’m not sure it’s the right change for everyone, but I’m happy with it
in my case: it’s a one-line addition to <code class="language-plaintext highlighter-rouge">/sbin/dhclient-script</code>; insert
this line just after the start of the <code class="language-plaintext highlighter-rouge">make_resolve_conf</code> function
that’s first in that file:</p>

<!-- prettier-ignore-start -->

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">    <span class="o">[</span> <span class="s2">"</span><span class="nv">$reason</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"RENEW"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>&lt;br /&gt;</code></pre></figure>

<!-- prettier-ignore-end -->

<p>This shortcuts the function that would be overwriting the DNS settings to do
nothing if we’re renewing the DHCP settings. (Admittedly, if the DNS server
addresses changed, I wouldn’t know about it, but my home DNS server’s address
hasn’t changed in a while, and I wasn’t in a coffeeshop when it did.)</p>

<p>With these mechanisms in place, I can open my laptop and see Network Manager’s
progress by looking at its icon in the menu bar: I see it associate with a
network and go through the VPN connection process, without me having to do anything. Perfect.</p>

<p>[Update: Almost perfect: in cleaning up the script for posting, I broke it — I’ve fixed it.]</p>
</div>
</article>

<div class="rellinks">
<div class="rellink previous">
  ← 
  <div>
  Coding: <a href="/coding/fixing-a-little-vpn-annoyance">Fixing a little VPN annoyance</a> <time>(Nov 17, 2008)</time><br>
All: <a href="/general/my-25-things">My 25 things</a> <time>(Feb 18, 2009)</time>
  </div>
  
</div>
<br><div class="rellink next">
  
  <div>
  <a href="/coding/rails233mochaconfusion">Rails 2.3.3 + mocha = confusion</a> <time>(Jul 30, 2009)</time>
  </div>
   →
</div>

</div>

        </div>
      </div>
    </div>
  </body>

</html>
